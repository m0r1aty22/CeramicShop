@{
    ViewBag.Title = "Đăng nhập";
}

<div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
        <div class="card login-card animate__animated animate__fadeIn">
            <div class="card-header text-center">
                <h4 class="mb-0">Đăng nhập vào tài khoản của bạn</h4>
            </div>
            <div class="card-body">
                @using (Html.BeginForm("Login", "Account", new { ReturnUrl = ViewBag.ReturnUrl }, FormMethod.Post, false, new { @class = "login-form", id = "loginForm" }))
                {
                    @Html.AntiForgeryToken()

                    @if (!ViewData.ModelState.IsValid && ViewData.ModelState.Values.SelectMany(v => v.Errors).Any())
                    {
                        <div id="loginErrorSummary" class="alert alert-danger login-error-summary mb-3" role="alert">
                            @* Hoặc nếu bạn muốn hiển thị lỗi cụ thể được thêm bằng ModelState.AddModelError(string.Empty, ...)*@
                            @if (ViewData.ModelState.ContainsKey(string.Empty) && ViewData.ModelState[string.Empty].Errors.Any())
                            {
                                <ul class="mb-0 ps-3">
                                    @* ps-3 để thêm padding start cho list *@
                                    @foreach (var error in ViewData.ModelState[string.Empty].Errors)
                                    {
                                        <li>@error.ErrorMessage</li>
                                    }
                                </ul>
                            }
                        </div>
                    }
                    else
                    {
                        @* Render một div trống và ẩn nếu bạn MUỐN dùng JS để hiện nó sau,
                           NHƯNG cách này không được khuyến khích bằng việc không render gì cả.
                           Nếu bạn muốn JS kiểm soát hoàn toàn, server không nên render khối alert nào cả
                           và JS sẽ tự tạo và chèn nó khi có lỗi.
                        *@
                        // <div id="loginErrorSummary" class="alert alert-danger login-error-summary mb-3 d-none" role="alert"></div>
                    }

                    <div class="mb-3">
                        <label for="username" class="form-label">Tên đăng nhập</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                            <input type="text" class="form-control" id="username" name="username" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Mật khẩu</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                            <input type="password" class="form-control" id="password" name="password" required>
                            <button class="btn btn-outline-secondary password-toggle" type="button" data-target="#password">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="rememberMe" name="rememberMe">
                        <label class="form-check-label" for="rememberMe">Ghi nhớ đăng nhập</label>
                    </div>

                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i> Đăng nhập
                        </button>
                    </div>
                }

                <div class="text-center mt-3">
                    <a href="@Url.Action("ForgotPassword", "Account")">Quên mật khẩu?</a>
                </div>

                <div class="social-login mt-4">
                    <p class="text-center mb-3">Hoặc đăng nhập với</p>
                    <div class="d-grid gap-2">
                        <button class="btn btn-outline-primary">
                            <i class="fab fa-facebook-f me-2"></i> Facebook
                        </button>
                        <button class="btn btn-outline-danger">
                            <i class="fab fa-google me-2"></i> Google
                        </button>
                    </div>
                </div>
            </div>
            <div class="card-footer text-center">
                <p class="mb-0">Chưa có tài khoản? <a href="@Url.Action("Register", "Account")">Đăng ký</a></p>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Toggle password visibility
            $('.password-toggle').click(function() {
                var target = $(this).data('target');
                var input = $(target);

                if (input.attr('type') === 'password') {
                    input.attr('type', 'text');
                    $(this).find('i').removeClass('fa-eye').addClass('fa-eye-slash');
                } else {
                    input.attr('type', 'password');
                    $(this).find('i').removeClass('fa-eye-slash').addClass('fa-eye');
                }
            });

            // Xử lý ẩn/hiện thông báo lỗi
            var errorSummary = $('#loginErrorSummary');
            if (errorSummary.length) { // Kiểm tra xem phần tử có tồn tại không
                // Nếu khối lỗi được render và có nội dung (không chỉ là whitespace)
                if ($.trim(errorSummary.text()).length > 0) {
                    errorSummary.removeClass('d-none'); // Đảm bảo nó được hiển thị nếu có lỗi
                                                       // và ban đầu bạn ẩn nó bằng class d-none
                } else {
                    // Nếu khối lỗi được render nhưng trống, ẩn nó đi
                    errorSummary.addClass('d-none');
                }
            }
        });
    </script>
}
